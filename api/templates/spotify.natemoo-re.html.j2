<svg width="320" height="{{ height }}" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-labelledby="cardTitle" role="img">
  <title id="cardTitle">Now playing on Spotify</title>
  <foreignObject width="320" height="{{ height }}">
    <style>
      div {
        font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji;
      }

      .container {
        display: flex;
        align-items: center;
        border-radius: 10px;
        padding: 10px 10px;
      }

      .cover-link {
        height: 64px;
      }

      .cover {
        border-radius: 1px;
        margin-right: 10px;
      }

      .playing {
        display: flex;
        justify-content: center;
        align-items: center;
        color: #53b14f;
        font-weight: bold;
        text-align: center;
        margin-bottom: 8px;
      }

      .not-play {
        color: #ff1616;
        text-align: center;
        margin-bottom: 0;
      }

      .artist {
        color: #121212;
        font-weight: 500;
        font-size: 14px;
        margin-bottom: 3px;
      }

      .song {
        color: #212122;
        font-size: 14px;
        margin-bottom: 18px;
      }

      .progress-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
      }

      .progress-time-left,
      .progress-time-right {
        font-size: 12px;
        color: #121212;
        text-align: center;
        white-space: nowrap;
      }

      .progress-bar {
        flex-grow: 1;
        height: 5px;
        background-color: #ccc;
        border-radius: 2px;
        overflow: hidden;
        position: relative;
        margin: 0 8px;
      }

      .progress {
        height: 100%;
        background-color: #{{ bar_color | safe }};
        {{ progress_bar_style | safe }};
        width: {{ progress_percentage }}%; /* Dynamically set width */
      }

      @media (prefers-color-scheme: light) {
        .artist {
          color: #121212;
        }

        .song {
          color: #212122;
        }

        .progress-time-left,
        .progress-time-right {
          color: #212122;
        }
      }

      @media (prefers-color-scheme: dark) {
        .artist {
          color: #f4f4f4;
        }

        .song {
          color: #dbdbdc;
        }

        .progress-time-left,
        .progress-time-right {
          color: #dbdbdc;
        }
      }
    </style>
    <div xmlns="http://www.w3.org/1999/xhtml" class="container">
      {% if song_name %}
        {% if cover_image %}
          <a href="{{ spotify_link }}" target="_BLANK" class="cover-link">
            <img src="data:image/png;base64, {{ img }}" width="64" height="64" class="cover" />
          </a>
        {% endif %}
        <div class="text-container">
          <div class="artist">{{ artist_name }}</div>
          <div class="song">{{ song_name }}</div>
          <div id="bars">{{ content_bar | safe }}</div>
          <div class="progress-container">
            <!-- Left Time (Current Time) -->
            <div class="progress-time-left">{{ progress_time_str }}</div>
            <!-- Progress Bar -->
            <div class="progress-bar">
              <div class="progress"></div> <!-- Dynamic progress -->
            </div>
            <!-- Right Time (Total Duration) -->
            <div class="progress-time-right">{{ total_duration_str }}</div>
          </div>
        </div>
      {% else %}
        <div class="playing not-play">Nothing playing on Spotify</div>
      {% endif %}
    </div>
  </foreignObject>
</svg>